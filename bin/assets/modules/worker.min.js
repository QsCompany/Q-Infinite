"use strict";function clone(n){var i,t;if(!n)return n;if(typeof n=="object"){i={};for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i}return n instanceof Array?n.splice(0):n}var exports={},isWorker,Workers,swReg,ServiceWorker;Object.defineProperty(exports,"__esModule",{value:!0});isWorker=typeof importScripts=="function"&&!(typeof window!="undefined"&&window instanceof Window);typeof exports=="undefined"&&typeof window!="undefined"&&(window.exports={}),function(n){var t;(function(t){function e(n,t){return n?n.indexOf("__")===0&&n.lastIndexOf("__")===n.length-2?!1:t?(i[n]=t,!0):!1:!1}function o(n){return n.indexOf("__")===0&&n.lastIndexOf("__")===n.length-2?!1:i[n]}function s(n){return n?n.indexOf("__")===0&&n.lastIndexOf("__")===n.length-2?!1:delete i[n]:!1}function r(n,t,i,r){try{return n&&n.apply(r,i)}catch(u){return(i=i.slice()).unshift(u),t&&t.apply(r,i)}}function c(){n.WebWorker.registerHandler("fetch",function(n){var t=n.Msg.Data;n.keepAlive=!0;n.Handled=!0;fetch(new Request(t.request.request)).then(function(i){n.Result=i;t.response=i;n.Thread.postMessage({Data:t,Id:n.Msg.Id,IsError:!1,keepAlive:!1})})})}var i={},h,u,f;t.registerHandler=e;t.getHandler=o;t.unregisterHandler=s;h=!1;u=function(){function n(){this.onPostMessageError=function(n,t){this.postMessage({Id:t.Id,IsError:!0,Data:"UnExpectedError",keepAlive:!1})}.bind(this);this.Start()}return n.prototype.Start=function(){this._worker=self;this._worker.addEventListener("error",this._onerror.bind(this),{capture:!0});this._worker.addEventListener("message",this._onmessage.bind(this),{capture:!0})},n.prototype._onerror=function(){},n.prototype._onmessage=function(n){var u=n.data,f=i[u.Handler],t={e:n,Msg:u,Result:undefined,Handled:!1,Thread:this},e=r(f,this._onHandlerError,[t],this);t.Handled||this.postMessage({Id:u.Id,Data:t.Result||e,keepAlive:t.keepAlive},n.origin,n.ports,n.ports.slice())},n.prototype._onHandlerError=function(n,t){t.Error=!0;t.Handled=!0;this.postMessage({Id:t.Msg.Id,IsError:!0,Data:n,keepAlive:!1})},n.prototype.postMessage=function(n,t,i,u){var e,f;if(u&&u.length!=0)for(e=[n],f=0;f<u.length;f++)r(u[f].postMessage,this.onPostMessageError,e,u[f]);else e=isWorker?[n,i]:[n,t?t:void 0,i],r(this._worker.postMessage,this.onPostMessageError,e,this._worker)},n.Start=function(){this.Default=new n},n}();t.Server=u;f=function(){function n(n){this._url=n;this._quee={};this.Start()}return n.prototype.Start=function(){this._worker=new Worker(this._url);this._worker.addEventListener("error",this._onerror.bind(this),{capture:!0});this._worker.addEventListener("message",this._onmessage.bind(this),{capture:!0})},n.prototype.Send=function(n){var t=performance.now();n.Id=t;this._quee[t]=n;this._worker.postMessage({Id:t,Data:n.data,Handler:n.handler})},n.prototype._onmessage=function(n){var t=n.data,i=this._quee[t.Id];i&&(r(i.callback,undefined,[i,t],i),t.keepAlive||delete this._quee[t.Id])},n.prototype._onerror=function(){},n.counter=0,n}();t.Client=f,function(){function n(n,t){i[n]=t}n("getValue",function(n){return self[n.Msg.Data]});n("__close__",function(){return isWorker&&self.close(),isWorker});n("__loadScripts__",function(n){importScripts(n.Msg.Data)});n("__hasHandler__",function(n){return i[n.Msg.Handler]instanceof Function});n("__href__",function(){return location.href});n("__getHandlers__",function(){return Object.keys(i)});c()}()})(t=n.WebWorker||(n.WebWorker={}))}(Workers=exports.Workers||(exports.Workers={}));ServiceWorker=function(){function n(){}return n.Start=function(n,t){return navigator.serviceWorker.register(n,t?{scope:t}:void 0).then(function(n){swReg=clone(swReg);console.log("SW registration succeeded. Scope is "+n.scope)}).catch(function(n){console.error("SW registration failed with error "+n)})},n.postMessageToSW=function(n){return new Promise(function(t,i){navigator.serviceWorker.getRegistration().then(function(r){var u=new MessageChannel;r.active.postMessage(n,[u.port2]);u.port1.onmessage=function(r){var u=r.data;(u.IsError?i:t)(u.IsError?{IsError:!0,Action:n,Result:u}:{Action:n,Result:u})}}).catch(function(t){i({IsError:!0,Action:n,Result:t})})})},n}();